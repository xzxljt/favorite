<script type='text/javascript' src='{{ relURL "assets/js/tooltip-extend.js" }}' id='iplaycode-nav-js'></script>
<script type='text/javascript' id='popper-js-extra'>
/* <![CDATA[ */
//var theme = {"ajaxurl":"https:\/\/nav.baidu.com\/wp-admin\/admin-ajax.php","addico":"https:\/\/nav.baidu.cn\/wp-content\/themes\/onenav\/images\/add.png","order":"asc","formpostion":"top","defaultclass":"io-grey-mode","isCustomize":"1","icourl":"https:\/\/api.badi.cn\/favicon\/","icopng":".png","urlformat":"1","customizemax":"10","newWindow":"0","lazyload":"1","minNav":"1","loading":"1","hotWords":"baidu","classColumns":" col-sm-6 col-md-4 col-xl-5a col-xxl-6a ","apikey":"TWpBeU1UVTNOekk1TWpVMEIvZ1M2bFVIQllUMmxsV1dZelkxQTVPVzB3UW04eldGQmxhM3BNWW14bVNtWk4="};
var theme = {"ajaxurl":"","addico":"https:\/\/nav.baidu.cn\/wp-content\/themes\/onenav\/images\/add.png","order":"asc","formpostion":"top","defaultclass":"io-grey-mode","isCustomize":"1","icourl":"","icopng":".png","urlformat":"1","customizemax":"10","newWindow":"0","lazyload":"1","minNav":"1","loading":"1","hotWords":"baidu","classColumns":" col-sm-6 col-md-4 col-xl-5a col-xxl-6a ","apikey":"TWpBeU1UVTNOekk1TWpVMEIvZ1M2bFVIQllUMmxsV1dZelkxQTVPVzB3UW04eldGQmxhM3BNWW14bVNtWk4="};
/* ]]> */
</script>
<!-- ç»“æŸ -->
<script type='text/javascript' src='{{ relURL "assets/js/popper.min.js" }}?v=1.16.1' id='popper-js'></script>
<script type='text/javascript' src='{{ relURL "assets/js/bootstrap.min.js" }}?v=4.6.2' id='bootstrap-js'></script>
<script type='text/javascript' src='{{ relURL "assets/js/theia-sticky-sidebar.min.js" }}?v=1.7.0' id='sidebar-js'></script>
<script type='text/javascript' src='{{ relURL "assets/js/lazyload.min.js" }}?v=19.1.3' id='lazyload-js'></script>
{{ if $.Site.Params.expandSidebar }}
<script type='text/javascript' src='{{ relURL "assets/js/app-anim.js" }}' id='appanim-js'></script>
{{ else }}
<script type='text/javascript' src='{{ relURL "assets/js/app-mini.js" }}' id='appmini-js'></script>
{{ end }}

<script type='text/javascript' src='{{ relURL "assets/js/fuse.min.js?v7.1.0" }}' id='fuse-js'></script>

<script>
    var lazyLoadInstance = new LazyLoad({
        elements_selector: ".lazy",
        data_src: "src",
        callback_error: (img) => {
            img.setAttribute("src", "assets/images/faviconV2.png");
        }
    });
</script>

<script type="text/javascript">
    $(document).ready(function(){
        var siteWelcome = $('#loading');
        siteWelcome.addClass('close');
        setTimeout(function() {
            siteWelcome.remove();
        }, 600);
    });
</script>

<script>
    $(document).ready(function(){
        setTimeout(function () {
            if ($('a.smooth[href="' + window.location.hash + '"]')[0]) {
                $('a.smooth[href="' + window.location.hash + '"]').click();
            }else if (window.location.hash != '') {
                $("html, body").animate({
                    scrollTop: $(window.location.hash).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
        }, 300);
        $(document).on('click','a.smooth',function(ev) {
            if($('#sidebar').hasClass('show') && !$(this).hasClass('change-href')){
                $('#sidebar').modal('toggle');
            }
            if($(this).attr("href").substr(0, 1) == "#"){
                $("html, body").animate({
                    scrollTop: $($(this).attr("href")).offset().top - 90
                }, {
                    duration: 500,
                    easing: "swing"
                });
            }
            if($(this).hasClass('go-search-btn')){
                $('#search-text').focus();
            }
            if(!$(this).hasClass('change-href')){
                var menu =  $("a"+$(this).attr("href"));
                menu.click();
                toTarget(menu.parent().parent(),true,true);
            }
        });
        $(document).on('click','a.tab-noajax',function(ev) {
            var url = $(this).data('link');
            if(url)
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').show().attr('href', url);
            else
                $(this).parents('.d-flex.flex-fill.flex-tab').children('.btn-move.tab-move').hide();
        });
        
    });
</script>

<script>
    // Mastodon æ»šåŠ¨ Ticker
    // è¿œç¨‹ JSON API åœ°å€
    let jsonUrl = "https://www.eallion.com/api/v1/accounts/111136231674527355/statuses?limit=10&exclude_replies=true&exclude_reblogs=false";

    // å¤„ç† Json æ•°æ®
    if (document.querySelector('#ticker')) {
        fetch(jsonUrl)
            .then(res => res.json())
            .then(data => {
                const tickerDom = document.querySelector('#ticker');
                if (!tickerDom) return;

                // ä½¿ç”¨ map å’Œ join ä¼˜åŒ– DOM æ“ä½œ
                const htmlItems = data.map((item, i) => {
                    const tickerUrl = item.url;
                    const tickerTime = getRelativeTime(new Date(item?.created_at)) || 'æœªçŸ¥æ—¶é—´';
                    
                    // ç»Ÿä¸€å¤„ç†å†…å®¹ï¼Œé¿å…é‡å¤ä»£ç 
                    const content = item.reblog && Object.keys(item.reblog).length > 0 
                        ? extractTextFromHtml(item.reblog.content) 
                        : extractTextFromHtml(item.content);
                    
                    const isReblog = item.reblog && Object.keys(item.reblog).length > 0;
                    const prefix = isReblog ? 'ã€è½¬ã€‘' : '';
                    const className = i === 0 ? 'carousel-item active' : 'carousel-item';
                    
                    return `<div class="${className}"><a class="overflowClip_1" href="${tickerUrl}" target="_blank" rel="bulletin"><span class="datetime">${tickerTime}</span>:  ${prefix}${content}</a></div>`;
                }).join('');

                tickerDom.innerHTML = htmlItems;
            })
            .catch(error => {
                console.error('Error fetching ticker data:', error);
            });
    }

    // æå– HTML ä»£ç ä¸­çš„çº¯æ–‡æœ¬å†…å®¹å¹¶æ›¿æ¢ç‰¹æ®Šå­—ç¬¦
    function extractTextFromHtml(html) {
        // é¦–å…ˆä½¿ç”¨ DOMParser æ–¹æ³•ï¼Œè¿™æ˜¯æœ€å‡†ç¡®çš„æ–¹å¼
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        let text = doc.body.textContent || '';
        
        // è½¬ä¹‰ HTML å®ä½“ä»¥é˜²æ­¢ XSS
        text = text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        
        // æ›¿æ¢ç‰¹æ®Šå­—ç¬¦
        const replacements = {
            '\\s*:star_empty:\\s*': 'ğŸŒ‘',
            '\\s*:star_half:\\s*': 'ğŸŒ—',
            '\\s*:star_solid:\\s*': 'ğŸŒ•'
        };
        
        for (const pattern in replacements) {
            const regex = new RegExp(pattern, 'g');
            text = text.replace(regex, replacements[pattern]);
        }
        
        return text;
    }

    // è®¡ç®—ç›¸å¯¹æ—¶é—´çš„å‡½æ•°
    function getRelativeTime(date) {
        const rtf = new Intl.RelativeTimeFormat('zh-CN', { numeric: "auto", style: 'short' });

        const now = new Date();
        const diff = now - date;

        const seconds = Math.floor(diff / 1000);
        const minutes = Math.floor(seconds / 60);
        const hours = Math.floor(minutes / 60);
        const days = Math.floor(hours / 24);
        const months = Math.floor(days / 30);
        const years = Math.floor(days / 365);

        if (years > 0) {
        return rtf.format(-years, 'year');
        } else if (months > 0) {
        return rtf.format(-months, 'month');
        } else if (days > 0) {
        return rtf.format(-days, 'day');
        } else if (hours > 0) {
        return rtf.format(-hours, 'hour');
        } else if (minutes > 0) {
        return rtf.format(-minutes, 'minute');
        } else {
        return rtf.format(-seconds, 'second');
        }
    }
</script>

<script>
//å¤œé—´ (æ—¥é—´) æ¨¡å¼ - åŸºäºç³»ç»Ÿåå¥½è‡ªåŠ¨åŠ è½½
(function(){
    // æ£€æŸ¥ cookie æ˜¯å¦å­˜åœ¨
    var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1");
    
    // å¦‚æœ cookie ä¸å­˜åœ¨ï¼Œæ ¹æ®ç³»ç»Ÿåå¥½è®¾ç½®
    if(night === ''){
        // æ£€æŸ¥ç”¨æˆ·ç³»ç»Ÿæ˜¯å¦åå¥½æš—è‰²æ¨¡å¼
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches){
            document.body.classList.add('io-black-mode');
            document.cookie = "night=1;path=/";
            console.log('æ£€æµ‹åˆ°ç³»ç»Ÿæš—è‰²åå¥½ï¼Œè‡ªåŠ¨å¼€å¯æš—é»‘æ¨¡å¼');
        }else{
            document.body.classList.add('io-grey-mode');
            document.cookie = "night=0;path=/";
            console.log('æ£€æµ‹åˆ°ç³»ç»Ÿäº®è‰²åå¥½ï¼Œä½¿ç”¨äº®è‰²æ¨¡å¼');
        }
    }else{
        // å¦‚æœ cookie å­˜åœ¨ï¼Œä½¿ç”¨ cookie çš„å€¼
        if(night == '0'){
            document.body.classList.remove('io-black-mode');
            document.body.classList.add('io-grey-mode');
        }else if(night == '1'){
            document.body.classList.add('io-black-mode');
            document.body.classList.remove('io-grey-mode');
        }
    }
})();
//å¤œé—´ (æ—¥é—´) æ¨¡å¼åˆ‡æ¢
$("#search-bg").css("background-image", "url({{ $.Site.Params.images.searchImageL }})");   //é»˜è®¤æµ…è‰²èƒŒæ™¯
function switchNightMode(){
    var night = document.cookie.replace(/(?:(?:^|.*;\s*)night\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
    if(night == '0'){
    $("#search-bg").css("background-image", "url({{ $.Site.Params.images.searchImageL }})");
        document.body.classList.remove('io-grey-mode');
        document.body.classList.add('io-black-mode');
        document.cookie = "night=1;path=/"
        $(".switch-dark-mode").attr("data-original-title","æ—¥é—´æ¨¡å¼");
        $(".mode-ico").removeClass("icon-night");
        $(".mode-ico").addClass("icon-light");
    }else{
    $("#search-bg").css("background-image", "url({{ $.Site.Params.images.searchImageD }})")
        document.body.classList.remove('io-black-mode');
        document.body.classList.add('io-grey-mode');
        document.cookie = "night=0;path=/"
        $(".switch-dark-mode").attr("data-original-title","å¤œé—´æ¨¡å¼");
        $(".mode-ico").removeClass("icon-light");
        $(".mode-ico").addClass("icon-night");
    }
}
</script>

<script>
// æœç´¢åŠŸèƒ½å®ç°
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.querySelector('.search-input');
    const searchIcon = document.querySelector('.search-icon');
    const searchIconSvg = document.querySelector('.search-icon-svg');
    const clearIconSvg = document.querySelector('.clear-icon-svg');
    const closeIconSvg = document.querySelector('.close-icon-svg');
    
    // æ ‡å¿—å˜é‡
    let fuse = null;
    let searchData = null;
    let debounceTimer = null;
    
    // é¡µé¢åŠ è½½æ—¶ç›´æ¥åˆå§‹åŒ–æœç´¢åŠŸèƒ½
    initializeSearch();
    
    // åˆå§‹åŒ–æœç´¢åŠŸèƒ½
    function initializeSearch() {
        // åŠ è½½ JSON æ•°æ®
        loadSearchData();
    }
    
    // åŠ è½½æœç´¢æ•°æ®
    function loadSearchData() {
        fetch('/index.json')
            .then(response => response.json())
            .then(data => {
                // è¿‡æ»¤æœ‰æ•ˆçš„æ•°æ®é¡¹ï¼Œdescription å¯ä»¥ä¸ºç©º
                searchData = data.filter(item => item.title && item.url);
                
                // åˆå§‹åŒ– Fuse - é’ˆå¯¹ä¸­æ–‡ä¼˜åŒ–çš„é…ç½®
                const options = {
                    includeScore: true,
                    threshold: 0.4, // é€‚åº¦çš„åŒ¹é…é˜ˆå€¼
                    location: 0,
                    distance: 150, // å¢åŠ æœç´¢è·ç¦»
                    minMatchCharLength: 1, // æœ€å°åŒ¹é…å­—ç¬¦é•¿åº¦è®¾ä¸º 1
                    keys: [
                        {
                            name: 'title',
                            weight: 0.5
                        },
                        {
                            name: 'description',
                            weight: 0.3
                        },
                        {
                            name: 'url',
                            weight: 0.2
                        }
                    ],
                    shouldSort: true,
                    includeMatches: true,
                    findAllMatches: true, // æŸ¥æ‰¾æ‰€æœ‰åŒ¹é…é¡¹
                    useExtendedSearch: false,
                    ignoreLocation: true, // å¿½ç•¥åŒ¹é…ä½ç½®
                    ignoreFieldNorm: true  // å¿½ç•¥å­—æ®µæ ‡å‡†åŒ–
                };
                fuse = new Fuse(searchData, options);
            })
            .catch(error => {
                console.error('Failed to load search data:', error);
            });
    }
    
    // æœç´¢æ‰§è¡Œå‡½æ•°
    function executeSearch(query) {
        if (!fuse || !searchData || !query.trim()) {
            clearSearchResults();
            return;
        }
        
        // æ‰§è¡Œæœç´¢ï¼Œä¸é™åˆ¶ç»“æœæ•°é‡
        const results = fuse.search(query);
        
        // æ˜¾ç¤ºæœç´¢ç»“æœæ ‡é¢˜ï¼Œéšè—åˆ†ç±»å†…å®¹
        document.querySelector('.search-result-title')?.classList.remove('hidden');
        document.querySelectorAll('.category-item, .category-title').forEach(el => {
            el.classList.add('hidden');
        });
        
        // æ¸²æŸ“æœç´¢ç»“æœ
        renderSearchResults(results);
    }
    
    // æ¸²æŸ“æœç´¢ç»“æœ
    function renderSearchResults(results) {
        // æ‰¾åˆ° content_main.html ä¸­çš„æœç´¢ç»“æœå®¹å™¨
        let resultsContainer = document.querySelector('.search-results');
        if (!resultsContainer) {
            // å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨
            resultsContainer = document.createElement('div');
            resultsContainer.className = 'search-results mt-4';
            searchInput.closest('.s-search').after(resultsContainer);
        } else {
            // ç§»é™¤ hidden ç±»
            resultsContainer.classList.remove('hidden');
        }
        
        // æ¸…ç©ºå®¹å™¨
        resultsContainer.innerHTML = '';
        
        if (results.length === 0) {
            resultsContainer.innerHTML = '<div class="no-results text-center py-4">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç»“æœ</div>';
            return;
        }
        
        // åˆ›å»ºç»“æœè¡Œ
        const row = document.createElement('div');
        row.className = 'row';
        resultsContainer.appendChild(row);
        
        // æ¸²æŸ“æ¯ä¸ªç»“æœ
        results.forEach(item => {
            const data = item.item;
            const url = data.url.replace(/`/g, ''); // ç§»é™¤ URL ä¸­çš„åå¼•å·
            const title = data.title;
            const description = data.description || '';
            const logo = data.logo || '';
            const logoUrl = `assets/images/logos/${logo}`;
            
            // åˆ›å»ºå¡ç‰‡ HTML
            const cardHtml = `
            <div class="url-card col-6 col-sm-6 col-md-4 col-xl-5a col-xxl-6a">
                <div class="url-body default">
                    <a href="${url}" target="_blank" data-id="" data-url="${url}" class="card no-c mb-4" data-toggle="tooltip" data-placement="bottom" data-original-title="${description}" aria-describedby="tooltip73576">
                        <div class="card-body">
                            <div class="url-content d-flex align-items-center">
                                <div class="url-img mr-2 d-flex align-items-center justify-content-center">
                                    <img class="lazy" src="${logoUrl}" data-src="${logoUrl}" onerror="this.src='https://t3.gstatic.cn/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&size=128&url=${encodeURIComponent(url)}'" alt="${title}">
                                </div>
                                <div class="url-info flex-fill">
                                    <div class="text-sm overflowClip_1">
                                        <strong>${title}</strong>
                                    </div>
                                    <p class="overflowClip_1 m-0 text-muted text-xs">${description}</p>
                                </div>
                            </div>
                        </div>
                    </a>
                    <a href="${url}" target="_blank" class="togo text-center text-muted is-views" data-id="689" data-toggle="tooltip" data-placement="right" title="" rel="nofollow" data-original-title="ç›´è¾¾">
                        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="0 0 15 15"><path fill="currentColor" d="m6.146 10.146l-.353.354l.707.707l.354-.353zM9.5 7.5l.354.354l.353-.354l-.353-.354zM6.854 4.146L6.5 3.793l-.707.707l.353.354zm0 6.708l3-3l-.708-.708l-3 3zm3-3.708l-3-3l-.708.708l3 3zM7.5 1A6.5 6.5 0 0 1 14 7.5h1A7.5 7.5 0 0 0 7.5 0zM1 7.5A6.5 6.5 0 0 1 7.5 1V0A7.5 7.5 0 0 0 0 7.5zM7.5 14A6.5 6.5 0 0 1 1 7.5H0A7.5 7.5 0 0 0 7.5 15zm0 1A7.5 7.5 0 0 0 15 7.5h-1A6.5 6.5 0 0 1 7.5 14z"></path></svg>
                    </a>
                </div>
            </div>
            `;
            
            // å°† HTML æ·»åŠ åˆ°è¡Œä¸­
            row.insertAdjacentHTML('beforeend', cardHtml);
            lazyLoadInstance.update();
        });
    }
    
    // æ¸…é™¤æœç´¢ç»“æœ
    function clearSearchResults() {
        // éšè—æœç´¢ç»“æœæ ‡é¢˜ï¼Œæ˜¾ç¤ºåˆ†ç±»å†…å®¹
        document.querySelector('.search-result-title')?.classList.add('hidden');
        document.querySelectorAll('.category-item, .category-title').forEach(el => {
            el.classList.remove('hidden');
        });
        
        // æ‰¾åˆ°å¹¶éšè—æœç´¢ç»“æœå®¹å™¨
        const resultsContainer = document.querySelector('.search-results');
        if (resultsContainer) {
            resultsContainer.classList.add('hidden');
        }
    }
    
    // è¾“å…¥äº‹ä»¶å¤„ç†
    searchInput.addEventListener('input', function() {
        const query = this.value.trim();
        
        // æ˜¾ç¤º/éšè—æ¸…é™¤æŒ‰é’®
        if (query) {
            searchIconSvg.classList.add('d-none');
            clearIconSvg.classList.remove('d-none');
        } else {
            searchIconSvg.classList.remove('d-none');
            clearIconSvg.classList.add('d-none');
            closeIconSvg.classList.add('d-none');
            clearSearchResults();
        }
        
        // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
        if (debounceTimer) {
            clearTimeout(debounceTimer);
        }
        
        // è®¾ç½®æ–°çš„å®šæ—¶å™¨ï¼ˆ300ms åœé¡¿åæ‰§è¡Œæœç´¢ï¼‰
        debounceTimer = setTimeout(() => {
            executeSearch(query);
        }, 300);
    });
    
    // æœç´¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    searchIcon.addEventListener('click', function() {
        const query = searchInput.value.trim();
        if (query) {
            executeSearch(query);
        } else {
            clearSearchResults();
        }
    });
    
    // æ¸…é™¤æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    clearIconSvg.addEventListener('click', function(e) {
        e.stopPropagation();
        searchInput.value = '';
        searchIconSvg.classList.remove('d-none');
        clearIconSvg.classList.add('d-none');
        closeIconSvg.classList.add('d-none');
        clearSearchResults();
        searchInput.focus();
    });
    
    // å…³é—­æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    closeIconSvg.addEventListener('click', function(e) {
        e.stopPropagation();
        clearSearchResults();
    });
    
    // å›è½¦å’Œ Ctrl+ å›è½¦äº‹ä»¶
    searchInput.addEventListener('keydown', function(e) {
        // æ™®é€šå›è½¦é”® - ç«™å†…æœç´¢
        if (e.key === 'Enter' && !e.ctrlKey && !e.altKey) {
            e.preventDefault();
            executeSearch(this.value.trim());
        }
            
        // åŒæ—¶å¤„ç† Ctrl+Enter å’Œ Ctrl+Shift+Enter
        if (e.key === 'Enter' && e.ctrlKey) {
            e.preventDefault();
            const query = this.value.trim();
            if (query) {
                const url = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
                const newWindow = window.open(url, '_blank');
                if (newWindow) {
                    // å°è¯•èšç„¦æ–°æ ‡ç­¾é¡µã€‚
                    // æ³¨æ„ï¼šåœ¨æŸäº›æµè§ˆå™¨ä¸Šï¼ŒCtrl+Enter å¯èƒ½ä»æ— æ³•èšç„¦ã€‚
                    // ä½† Ctrl+Shift+Enter é€šå¸¸å¯ä»¥ã€‚
                    newWindow.focus();
                }
            }
        }
        
        // Alt+ å›è½¦é”® - ç™¾åº¦æœç´¢å¹¶åœ¨å‰å°æ‰“å¼€æ–°æ ‡ç­¾
        if (e.key === 'Enter' && e.altKey) {
            e.preventDefault();
            const query = this.value.trim();
            if (query) {
                // ä½¿ç”¨æ›´æ˜ç¡®çš„æ–¹å¼æ‰“å¼€æ–°æ ‡ç­¾é¡µ
                const url = `https://www.baidu.com/s?wd=${encodeURIComponent(query)}`;
                const newWindow = window.open(url, '_blank');
                if (newWindow) {
                    newWindow.focus();
                }
            }
        }

        // Delete é”® - æ¸…é™¤è¾“å…¥æ¡†å†…å®¹
        if (e.key === 'Delete') {
            e.preventDefault();
            this.value = '';
            searchIconSvg.classList.remove('d-none');
            clearIconSvg.classList.add('d-none');
            closeIconSvg.classList.add('d-none');
            clearSearchResults();
            this.focus();
        }
    });
});

// ç‚¹å‡» Google å›¾æ ‡æœç´¢åŠŸèƒ½
function openGoogleSearch() {
    const searchInput = document.getElementById('search-input');
    const query = searchInput.value.trim();
    const url = query 
        ? `https://www.google.com/search?q=${encodeURIComponent(query)}` 
        : 'https://www.google.com';
    
    const newWindow = window.open(url, '_blank');
    if (newWindow) {
        newWindow.focus();
    }
}

// æ·»åŠ å…¨å±€é”®ç›˜ç›‘å¬å™¨
document.addEventListener('DOMContentLoaded', function() {
    let isComposing = false; // ç”¨äºè·Ÿè¸ªæ˜¯å¦æ­£åœ¨è¾“å…¥æ³•ç»„åˆä¸­
    
    // ç›‘å¬è¾“å…¥æ³•ç»„åˆäº‹ä»¶
    document.addEventListener('compositionstart', function(e) {
        isComposing = true;
    });
    
    document.addEventListener('compositionend', function(e) {
        isComposing = false;
        // è¾“å…¥æ³•ç»„åˆç»“æŸåï¼Œç¡®ä¿ç„¦ç‚¹åœ¨æœç´¢æ¡†ä¸­
        const searchInput = document.getElementById('search-input');
        if (searchInput && document.activeElement !== searchInput) {
            searchInput.focus();
        }
    });
    
    // ç›‘å¬é”®ç›˜æŒ‰é”®
    document.addEventListener('keydown', function(e) {
        const searchInput = document.getElementById('search-input');
        
        // å¦‚æœæœç´¢æ¡†å·²ç»èšç„¦ï¼Œä¸å¤„ç†
        if (!searchInput || document.activeElement === searchInput) {
            return;
        }
        
        // å¦‚æœæ­£åœ¨è¾“å…¥æ³•ç»„åˆä¸­ï¼Œä¸å¤„ç†
        if (isComposing) {
            return;
        }
        
        // å¿½ç•¥ç‰¹æ®Šé”®ï¼ˆåŠŸèƒ½é”®ã€æ§åˆ¶é”®ç­‰ï¼‰
        if (e.ctrlKey || e.altKey || e.metaKey) {
            return;
        }
        
        // å¿½ç•¥ä¸éœ€è¦å¤„ç†çš„æŒ‰é”®
        const ignoredKeys = [
            'Shift', 'Control', 'Alt', 'Meta', 'CapsLock', 'Tab', 
            'Escape', 'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight',
            'F1', 'F2', 'F3', 'F4', 'F5', 'F6', 'F7', 'F8', 'F9', 'F10', 'F11', 'F12',
            'Backspace', 'Delete', 'Enter', 'PageUp', 'PageDown', 'Home', 'End',
            'Insert', 'ContextMenu', 'NumLock', 'ScrollLock', 'Pause'
        ];
        
        if (ignoredKeys.includes(e.key)) {
            return;
        }
        
        // æ¿€æ´»æœç´¢æ¡†å¹¶å¤„ç†å­—ç¬¦è¾“å…¥
        e.preventDefault();
        searchInput.focus();
        searchInput.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center'
        });
        
        // å¦‚æœæ˜¯å¯æ‰“å°å­—ç¬¦ï¼Œæ’å…¥åˆ°è¾“å…¥æ¡†ä¸­
        if (e.key.length === 1) {
            const startPos = searchInput.value.length;
            searchInput.value = searchInput.value + e.key;
            // è®¾ç½®å…‰æ ‡ä½ç½®åˆ°æœ«å°¾
            searchInput.setSelectionRange(startPos + 1, startPos + 1);
            
            // è§¦å‘ input äº‹ä»¶ä»¥ä¾¿æ‰§è¡Œæœç´¢
            const inputEvent = new Event('input', { bubbles: true });
            searchInput.dispatchEvent(inputEvent);
        }
    });
});

</script>

</body>
</html>
